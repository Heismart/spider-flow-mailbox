<div class="layui-tab layui-tab-fixed layui-tab-brief">
  <ul class="layui-tab-title">
    <li class="layui-this">基本配置</li>
  </ul>
  <div class="layui-tab-content editor-form-node">
    <div class="layui-tab-item layui-show">
    	<form class="layui-form">
    		<div class="layui-form-item">
    			<label class="layui-form-label">节点名称</label>
    			<div class="layui-input-block">
    				<input type="text" name="value" placeholder="请输入节点名称" value="{{=d.value}}" autocomplete="off" class="layui-input">
    			</div>
    		</div>
    		<div class="layui-form-item">
    			<label class="layui-form-label">host</label>
    			<div class="layui-input-block">
    				<input type="text" name="host" placeholder="请输入邮箱 host" autocomplete="off" class="layui-input input-default" value="{{=d.data.object.host}}">
    			</div>
    		</div>
    		<div class="layui-form-item">
    			<label class="layui-form-label">port</label>
    			<div class="layui-input-block">
    				<input type="text" name="port" placeholder="请输入邮箱 port，默认25" autocomplete="off" class="layui-input input-default" value="{{=d.data.object.port}}">
    			</div>
    		</div>
    		<div class="layui-form-item">
    			<label class="layui-form-label">用户名</label>
    			<div class="layui-input-block">
    				<input type="text" name="username" placeholder="请输入邮箱用户名" autocomplete="off" class="layui-input input-default" value="{{=d.data.object.username}}">
    			</div>
    		</div>
    		<div class="layui-form-item">
    			<label class="layui-form-label">密码</label>
    			<div class="layui-input-block">
    				<input type="password" name="password" placeholder="请输入邮箱 password" autocomplete="off" class="layui-input input-default" value="{{=d.data.object.password}}">
    			</div>
    		</div>
    		<div class="layui-form-item">
    			<label class="layui-form-label">测试邮箱</label>
    			<div class="layui-input-block">
    				<input type="text" name="mail" placeholder="请输入测试邮箱" autocomplete="off" class="layui-input input-default" value="{{=d.data.object.mail}}">
    			</div>
    		</div>
    		<div class="layui-form-item">
    			<label class="layui-form-label">超时时间</label>
    			<div class="layui-input-block">
    				<input type="text" name="timeout" placeholder="请输入邮箱 数据库索引,默认为60000" autocomplete="off" class="layui-input input-default" value="{{=d.data.object.timeout}}">
    			</div>
    		</div>
    		<div class="layui-form-item">
    			<div class="layui-input-block">
    				<button class="layui-btn btn-mailbox-datasource-test" type="button">测试连接</button>
    			</div>
    		</div>
    	</form>
    </div>
  </div>
</div>
<script>
	$('.layui-form').on('click','.btn-mailbox-datasource-test',function(){
		var $form = $('.layui-form');
		var host = $form.find('input[name=host]').val();
		var port = $form.find('input[name=port]').val();
		var username = $form.find('input[name=username]').val();
		var password = $form.find('input[name=password]').val();
		var mail = $form.find('input[name=mail]').val();
		var timeout = $form.find('input[name=timeout]').val();
		$.ajax({
			url : 'mailbox/test',
			data : {
				host : host || '127.0.0.1',
				port : port || 25,
				username : username,
				password : password,
				mail : mail,
				timeout : timeout || 60000
			},
			type : 'post',
			dataType : 'json',
			success : function(json){
				if(json.code == 1){
					layui.layer.msg('测试成功');
				}else{
					layui.layer.alert('测试失败,' + json.message || '',{
						icon : 2
					})
				}
			},
			error : function(){
				layui.layer.msg('测试失败');
			}
		})
	});
</script>